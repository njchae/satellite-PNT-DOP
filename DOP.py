import numpy as  np
import matplotlib.pyplot as plt

def DOP_calc(sat_coords, rec_coords, interval):
    #Dilution of Precision
    #inputs are nested lists of xyz coords
    rec_x = rec_coords[0]
    rec_y = rec_coords[1]
    rec_z = rec_coords[2]

    A = []

    #generate array of nested lists, each item corresponding to a row in the matrix
    for i in sat_coords:
        x = rec_x - i[0][interval]
        y = rec_y - i[1][interval]
        z = rec_z - i[2][interval]
        
        R = get_R(i, rec_coords)
        
        A.append([x / R, y / R, z / R, 1])
    
    A = np.array(A)

    print("A matrix \n", A, "\n")
    print("A transpose \n", A.transpose(), "\n")

    A_T = A.transpose()


    Q = np.linalg.inv(np.dot(A_T, A))
    print("Q matrix \n", Q, "\n")

    #for 4 sat constellation
    #print(Q[0, 0] + Q[1, 1] + Q[2, 2])
    PDOP = np.sqrt(Q[0, 0] + Q[1, 1] + Q[2, 2])
    TDOP = np.sqrt(Q[3, 3])
    GDOP = np.sqrt(PDOP ** 2 + TDOP ** 2)

    return "PDOP: " + str(PDOP) + ",  " + "TDOP: " + str(TDOP) + ",  " + "GDOP: " + str(GDOP)


def get_R(sat, rec):
    return np.sqrt((rec[0] - sat[0][interval]) ** 2 + (rec[1] - sat[1][interval]) ** 2 + (rec[2] - sat[2][interval]) ** 2)


#receiver coords
test_rec = [1063690.920803595, 1063690.920803595, -868499.9999999999]

#constellation coords

const = [
    [
        [1935361.52943752, 406139.54688038, -1557657.17178803, 
        -1863381.0852784,-187029.14860499, 1687518.14823092, 
        1759225.70649009,-49631.9733638 , -1806641.61642004, 
        -1641004.95279051, 270207.84395265, 1892268.24814237],

        [1117381.5, 1377178.57897271, 166480.02297868,
        -1222183.00550124, -1310725.46358528, -3213.89202974,
        1307091.77809436, 1220334.3369647 , -168986.6329967, 
        -1379001.86807523, -1121851.16862873, 330598.59207101],

        [0.0, -1714040.70337915, -1598690.71562347, 
        219539.15146935, 1804116.20143783, 1466254.42375986, 
        -437103.51433049, -1873484.05522006, -1311117.58585888,
        647350.82526018,  1916783.61010791,  1142854.48555946]
    ],
    [
        [555374.84438537,  1972188.96873258,  1281286.35818839,
        -779183.4334116 , -2010066.6360941 , -1102502.37929236,
         977881.12691067,  2013959.84012039,   897360.3899729 ,
       -1178483.0544905 , -1999582.51751466,  -693632.21723363],

        [ -970885.44473846,   535181.23923745,  1468951.28195093,
         833187.6772139 ,  -691473.10613661, -1480753.3283042 ,
        -693997.52836127,   832477.69016502,  1468954.26632612,
         536344.60021305,  -968452.99726639, -1443163.80555117], 
         
        [ 1937296.89096825,   905193.88912968, -1093800.38721281,
       -1924574.16336327,  -703559.1109521 ,  1266334.92425633,
        1887866.1903279 ,   495423.84849837, -1426294.50542274,
       -1825113.16343783,  -279009.76123135,  1564042.5873191 ]
    ],  
    [
        [-1939236.12709405,  -413506.10334502,  1551662.05248327,
        1859330.57308328,   179413.15846669, -1693055.92425056,
       -1763542.79173011,    41859.406083  ,  1801547.07492385,
        1636344.35657515,  -278036.07290405, -1896956.47715393], 

        [-1.11961850e+06, -1.38036527e+06, -1.71144488e+05,  
        1.22013556e+06, 1.30720309e+06, -1.26138436e+03, 
        -1.30901699e+06, -1.22418381e+06, 1.64758180e+05,  
        1.37712526e+06,  1.11770003e+06, -3.34535291e+05], 
        
        [ 2.37487932e-10,  1.71244111e+06,  1.60049549e+06, 
        -2.19975830e+05, -1.80542828e+06, -1.46433736e+06,  
        4.36252634e+05,  1.87252702e+06, 1.31304826e+06, 
        -6.48572113e+05, -1.91733635e+06, -1.14100956e+06]
    ], 
    [
        [ -563124.03711537, -1976446.20548184, -1286915.03425868,
        771610.15463021,  2006058.83421928,  1096416.35965396,
        -985187.83364219, -2017811.06384631,  -903889.64387137,
        1171519.85753644,  1995786.95606679,   686696.65160677], 
        
        [966411.44622979,  -538705.55189228, -1470997.81755554,
        -837851.22972896,   688284.47840195,  1478517.6036319 ,
        689211.74708802,  -835339.22179777, -1471436.81476175,
        -541178.99389082,   965893.13723642,  1440389.50270967], 
        
        [-1937296.89096825,  -903594.29532222,  1091995.61415318,
        1925010.84032124,   704871.19431716, -1268251.98486267,
       -1887015.31206552,  -494466.80863155,  1424363.82833236,
        1826334.44850071,   279562.49864083, -1565887.50907933]
    ]
]

net_const = []

interval = 0
for i in const:
    temp_const = []
    for j in range(3):
        temp_const.append(i[j][interval])
    net_const.append(temp_const)



#test coords
#c = 1000000
#d = -1000000
#test1 = [const[0][0][1] + c, const[0][1][1] + d, const[0][2][1] + c]
#test2 = [const[1][0][1] + c, const[1][1][1] + d, const[1][2][1] + c]
#test3 = [const[2][0][1] + c, const[2][1][1] + d, const[2][2][1] + c]
#test4 = [const[3][0][1] + c, const[3][1][1] + d, const[3][2][1] + c]
#test_const = [test1, test2, test3, test4]




test = [[np.array([2234763.        , 2229267.14190183, 2212806.67976498,
       2185462.81392574, 2147370.42521969, 2098717.39794707,
       2039743.67711251, 1970740.06498675, 1892046.76342276,
       1804051.66970147]), np.array([      0.        ,  -78355.34461146, -156325.3010414 ,
       -233526.393589  , -309578.96168968, -384109.04297713,
       -456750.2270977 , -527145.47079192, -594948.86498229,
       -659827.34488232]), np.array([      0.        ,  135715.43791162,  270763.3639122 ,
        404479.57860447,  536206.49060094,  665296.37808305,
        791114.59970184,  913042.73839143, 1030481.66205477,
       1142854.48555946])], 
       
       [np.array([2064153.45863883, 1999056.97327035, 1924131.19794713,
       1839745.48882012, 1746315.74726829, 1644302.33925809,
       1534207.79442166, 1416574.29699415, 1291980.98179714,
       1161041.04942049]), np.array([-428426.98860101, -499747.54465638, -568610.86708384,
       -634678.63907857, -697626.39415525, -757145.11673759,
       -812942.76400436, -864745.70140277, -912300.04472543,
       -955372.90216743]), np.array([ 742057.31159068,  865588.13830265,  984862.91152501,
       1099295.64936276, 1208324.35937796, 1311413.81089218,
       1408058.17090102, 1497783.49045639, 1580150.02921181,
       1654754.40672852])], 
       
       [np.array([1578441.18242032, 1463705.83746198, 1341778.65800099,
       1213259.80080905, 1078781.65649539,  939005.70600833,
        794619.23711942,  646331.93777084,  494872.38370228,
        340984.4382098 ]), np.array([ -791457.98656576,  -844863.56030328,  -894117.96107354,
        -938979.89867814,  -979229.77752176, -1014670.7655879 ,
       -1045129.74890378, -1070458.16702843, -1090532.72573361,
       -1105255.98369621]), np.array([1370845.44478806, 1463346.61190881, 1548657.73653927,
       1626360.89179641, 1696075.72695205, 1757461.31895305,
       1810217.82560306, 1854087.93267029, 1888858.08828718,
       1914359.51913136])], 
       
       [np.array([ 851915.34375163,  705076.38214801,  554776.57303116,
        401754.20111412,  246760.61935998,   90556.54575749,
        -66091.67990546, -222415.8606693 , -377649.70984749,
       -531032.60281351]), np.array([-1033753.89951753, -1061116.42569955, -1083270.53241032,
       -1100108.5478786 , -1111548.94667125, -1117536.728961  ,
       -1118043.66861972, -1113068.42934566, -1102636.54869257,
       -1086800.2905204 ]), np.array([1790514.27648682, 1837907.56205751, 1876279.60047687,
       1905443.89876656, 1925259.25073428, 1935630.39388478,
       1936508.43913006, 1927891.07192758, 1909822.52461793,
       1882393.32086194])], 
       
       [np.array([   -4473.99850867,  -161017.2499747 ,  -316771.10191892,
        -470972.25681847,  -622865.3399426 ,  -771706.58783286,
        -916767.4741254 , -1057338.2553599 , -1192731.419916  ,
       -1322285.02378323]), np.array([-1118498.88150075, -1115678.36463518, -1107387.96199579,
       -1093669.45126933, -1074591.18327281, -1050247.72569556,
       -1020759.37959112,  -986271.57137469,  -946954.1236587 ,
        -903000.40881272]), np.array([1937296.89096825, 1932411.61245349, 1918052.21386686,
       1894291.05628446, 1861246.52679407, 1819082.42143837,
       1768007.1077543 , 1708272.47168176, 1640172.65461372,
       1564042.5873191 ])], 
       
       [np.array([ -860208.14056661, -1002628.33032407, -1140138.45107487,
       -1272066.11230878, -1397766.45303948, -1516625.26325789,
       -1628061.95288974, -1731532.35453773, -1826531.3471295 ,
       -1912595.28847856]), np.array([-1032963.00198752, -1000422.6835226 ,  -962983.07076143,
        -920828.38165291,  -874165.81508213,  -823224.52546519,
        -768254.49261603,  -709525.29254912,  -647324.77530839,
        -581957.6563078 ]), np.array([1789144.40178126, 1732782.91690554, 1667935.60538749,
       1594921.54207427, 1514099.6059621 , 1425866.7041425 ,
       1330655.81435401, 1228933.85595024, 1121199.39983223,
       1007980.22857881])], 
       
       [np.array([-1585152.18391165, -1691818.41764353, -1790207.10098466,
       -1879837.99948761, -1960273.735509  , -2031121.89099493,
       -2092036.89237619, -2142721.66909549, -2182929.07833346,
       -2212463.08956774]), np.array([-790339.48749784, -733055.50329938, -672184.89098108,
       -608025.9056857 , -540892.77406343, -471114.16113756,
       -399031.56921448, -324997.67648122, -249374.62317899,
       -172532.25345167]), np.array([1368908.14757421, 1269689.3764825 , 1164258.38325938,
       1053131.76096571,  936853.76612473,  815993.66325545,
        691142.95170341,  562912.48800731,  431929.51746435,
        298834.62892265])], 
        
        [np.array([-2069282.66182385, -2124023.53140008, -2168378.20312928,
       -2202130.41695602, -2225115.62443384, -2237221.7768274 ,
       -2238389.86160288, -2228614.1849267 , -2207942.39892044,
       -2176475.27355135]), np.array([-427636.08957967, -354326.9722228 , -279285.23775182,
       -202877.91242247, -125478.64166413,  -47465.87810666,
         30778.95285691,  108873.30139232,  186435.34679652,
        263085.84766551]), np.array([ 740687.43430206,  613712.31838193,  483736.22159011,
        351394.85204923,  217335.38262701,   82213.3125066 ,
        -53310.71015193, -188574.08959926, -322915.49297829,
       -455678.05490898])], 
       
       [np.array([-2239237.        , -2233763.0545901 , -2217367.90122101,
       -2190131.46074855, -2152186.50941155, -2103718.04302992,
       -2044962.39083435, -1976206.08286688, -1897784.47599657,
       -1810080.1446856 ]), np.array([-1.37113721e-10,  7.81991739e+04,  1.56016019e+05,  2.33070060e+05,
        3.08984516e+05,  3.83388132e+05,  4.55916973e+05,  5.26216199e+05,
        5.93941781e+05,  6.58762178e+05]), np.array([ 2.37487932e-10, -1.35444942e+05, -2.70227672e+05, -4.03689186e+05,
       -5.35176881e+05, -6.64047723e+05, -7.89671362e+05, -9.11433192e+05,
       -1.02873734e+06, -1.14100956e+06])], 
       
       [np.array([-2069282.66182385, -2004422.52985154, -1929759.46661622,
       -1845657.68142801, -1752527.51326518, -1650823.45910857,
       -1541041.98800079, -1423719.15071772, -1299427.9959132 ,
       -1168775.80453506]), np.array([427636.08957967, 498853.96375869, 567632.11058387, 633633.88192912,
       696536.10432658, 756030.65422511, 811825.96236134, 863648.43999648,
       911243.82009663, 954378.4068908 ]), np.array([ -740687.43430206,  -864040.41078717,  -983167.65553881,
       -1097486.07689834, -1206435.92199973, -1309483.50519742,
       -1406123.81371334, -1495882.97795151, -1578320.59449052,
       -1653031.89038151])], 
       
       [np.array([-1585152.18391165, -1470729.17986023, -1349108.22209148,
       -1220883.46816741, -1086681.54690655,  -947158.52776414,
        -802996.74333173,  -654901.47976029,  -503597.55062105,
        -349825.77036762]), np.array([ 790339.48749784,  843756.01775478,  893043.07300864,
        937958.72331267,  978282.32077142, 1013815.5891329 ,
       1044383.6065482 , 1069835.67647807, 1090046.08222248,
       1104914.72107164]), np.array([-1368908.14757421, -1461428.29194327, -1546795.97579842,
       -1624592.16417998, -1694434.68372249, -1755980.10988356,
       -1808925.4691335 , -1853009.74740984, -1888015.19700075,
       -1913768.43492687])], 
       
       [np.array([-860208.14056661, -713574.5423957 , -563445.08430149,
       -410554.71365541, -255652.19738912,  -99496.46943185,
         57147.07756543,  213510.33830259,  368826.26047952,
        522332.61158171]), np.array([1032963.00198752, 1060443.70461267, 1082729.16707044,
       1099709.14419104, 1111299.32936434, 1117441.78829327,
       1118105.26457588, 1113285.35519799, 1103004.55464169,
       1087312.16695221]), np.array([-1789144.40178126, -1836742.3749557 , -1875341.92820273,
       -1904752.11128697, -1924826.90087625, -1935465.95182457,
       -1936615.12645566, -1928266.79852528, -1910459.92961929,
       -1883279.91684905])], 
       
       [np.array([  -4473.99850867,  152091.16552933,  307910.32590151,
        462218.90563099,  614259.42543218,  763285.23342024,
        908564.1875192 , 1049382.27210506, 1185047.13063638,
       1314891.49634001]), np.array([1118498.88150075, 1115834.5348855 , 1107697.24296155,
       1094125.78381953, 1075185.6273835 , 1050968.63559225,
       1021592.63189926,  987200.84180871,  947961.20682938,
        904065.57488763]), np.array([-1937296.89096825, -1932682.10726167, -1918587.90421338,
       -1895081.44744654, -1862276.13419604, -1820331.07400712,
       -1769450.34308752, -1709882.01528746, -1641916.97383279,
       -1565887.50907933])], 
       
       [np.array([ 851915.34375163,  994571.88608051, 1132344.71815876,
       1264556.30269467, 1390556.21635081, 1509724.38016869,
       1621474.1435043 , 1725255.20550304, 1820556.35890867,
       1906908.04185984]), np.array([1033753.89951753, 1001316.26298711,  963961.82599813,
        921873.1378075 ,  875256.10426193,  824338.98772541,
        769371.29442305,  710622.55452289,  648381.0008639 ,
        582952.15279811]), np.array([-1790514.27648682, -1734330.64193867, -1669630.85918563,
       -1596731.11281554, -1515988.04221647, -1427797.00940031,
       -1332590.17182576, -1230834.36943804, -1123028.83615863,
       -1009702.74702797])], 
       
       [np.array([1578441.18242032, 1685419.75717541, 1784114.66254859,
       1874039.66485625, 1954751.62462244, 2025852.7122462 ,
       2086992.39891651, 2137869.21221992, 2178232.24710568,
       2207882.42415292]), np.array([791457.98656576, 734163.04626025, 673259.77983857, 609047.08216217,
       541840.23215655, 471969.33906241, 399777.71305234, 325620.16841072,
       249861.26785856, 172873.51694289]), np.array([-1370845.44478806, -1271607.69716229, -1166120.14537305,
       -1054900.49050646,  -938494.81168006,  -817474.87487079,
        -692435.31074035,  -563990.6756565 ,  -432772.4107746 ,
        -299425.7146282 ])], 
        
        [np.array([2064153.45863883, 2119099.69247252, 2163624.7159848 ,
       2197508.93171932, 2220585.20514853, 2232739.70344143,
       2233912.46690748, 2224097.71005166, 2203343.85062528,
       2171753.26651643]), np.array([ 428426.98860101,  354999.69474287,  279826.60435498,
        203277.31710489,  125728.25961991,   47560.81902665,
        -30840.54897707, -109090.22781213, -186803.35367235,
       -263597.72531099]), np.array([-742057.31159068, -614877.50796609, -484673.89605231,
       -352086.64125196, -217767.73360889,  -82377.75500375,
         53417.3977616 ,  188949.81717987,  323552.89958477,
        456564.65299823])]]

obama = DOP_calc(test, test_rec, 0)






